<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Room</title>
  </head>
  <body>
    <h1>Create a New Room</h1>
    <form action="/chat" method="POST">
      <label for="roomName">Room Name:</label>
      <input type="text" id="roomName" name="roomName" required />
      <button type="submit">Create Room</button>
    </form>

    <h1>Available Rooms</h1>
    <div id="roomList">
      <!-- 방 목록이 동적으로 추가될 공간 -->
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
      // 방 목록을 받아와서 동적으로 div 칸 생성하는 함수
      function showRoomList(roomList) {
        const roomListDiv = document.getElementById("roomList");

        // 기존 목록 초기화
        roomListDiv.innerHTML = "";

        // 각 방 정보에 대해 div 칸을 생성하여 목록에 추가
        roomList.forEach((roomName) => {
          const roomDiv = document.createElement("div");

          // 이름 표시
          const roomNameSpan = document.createElement("span");
          roomNameSpan.textContent = roomName;
          roomDiv.appendChild(roomNameSpan);

          // 입장 버튼 생성
          const enterButton = document.createElement("button");
          enterButton.textContent = "Enter";
          enterButton.onclick = () => {
            // 버튼 클릭 시 해당 방으로 이동
            window.location.href = `/chat/${roomName}`;
          };
          roomDiv.appendChild(enterButton);

          roomListDiv.appendChild(roomDiv);
        });
      }

      // 서버로부터 방 목록을 받아오는 함수
      async function getRoomList() {
        try {
          const response = await fetch("/rooms");
          const roomList = await response.json();
          showRoomList(roomList);
        } catch (err) {
          console.error("방 목록을 가져오는데 실패했습니다.", err);
        }
      }

      // 페이지 로드시 방 목록을 가져오도록 설정
      window.addEventListener("load", getRoomList);

      // ... 이하 스크립트 코드 ...
    </script>
  </body>
</html>
